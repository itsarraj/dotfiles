#!/bin/bash
Dir="$HOME/mnt/"
Devices=$(simple-mtpfs -l 2>&1 | grep -v '^$')
i=1

if [ ! -d "$Dir" ]; then
  mkdir -p "$Dir"
fi

if [ -z "$Devices" ]; then
  notify-send "No devices found"
  exit 1
fi

# Mount or unmount all devices

echo "$Devices" | while read -r Device; do
  Id=${Device%%:*}
  Name=${Device##*: }
  SafeName=$(echo "$Name" | tr -cd '[:alnum:]_-')
  MountPoint="$Dir$SafeName"
  if [ -z "$SafeName" ]; then
    MountPoint="$Dir/device$i"
  fi
  if mountpoint -q "$MountPoint"; then
    fusermount -u "$MountPoint" && notify-send "Android Mount" "Device Unmounted from $MountPoint"
  else
    mkdir -p "$MountPoint"
    aft-mtp-mount "$MountPoint" && notify-send "Android Mount" "Device Mounted in $MountPoint"
  fi
  i=$((i+1))
done
